<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM Express - Pre-order Products by STEM Students</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6d28d9;
            --secondary: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        
        .bg-pattern {
            background-image: radial-gradient(circle at 10% 20%, rgba(109, 40, 217, 0.1) 0%, rgba(109, 40, 217, 0.05) 90%);
        }

        /* Animations & Effects */
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(109, 40, 217, 0.2), 0 0 15px rgba(16, 185, 129, 0.2);
        }
        .card-enter {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .card-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
        .modal-enter-active {
            animation: fadeIn 0.3s ease;
        }
        .modal-exit-active {
            animation: fadeOut 0.3s ease;
        }
        .cart-bounce {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 3s ease-in-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .fade-in { animation: fadeIn 1s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .glow { animation: glow 2s infinite alternate; }
        @keyframes glow {
            from { box-shadow: 0 0 5px -5px var(--primary); }
            to { box-shadow: 0 0 20px 2px var(--primary); }
        }
        .text-glow { text-shadow: 0 0 10px rgba(109, 40, 217, 0.7); }
    </style>
</head>
<body class="bg-pattern">
    <!-- Navigation -->
    <nav class="bg-gray-900 bg-opacity-90 backdrop-blur-md sticky top-0 z-40 border-b border-purple-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <a href="#home" class="flex items-center">
                            <i class="fas fa-atom text-purple-500 text-2xl mr-2"></i>
                            <span class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400">STEM EXPRESS</span>
                        </a>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#home" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:bg-purple-900 hover:bg-opacity-50">Home</a>
                            <a href="#products" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:bg-purple-900 hover:bg-opacity-50">Products</a>
                            <a href="#about" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:bg-purple-900 hover:bg-opacity-50">About</a>
                            <a href="#contact" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 hover:bg-purple-900 hover:bg-opacity-50">Contact</a>
                        </div>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-4 flex items-center md:ml-6">
                        <button id="cart-button" class="p-1 rounded-full text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white relative">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cart-count" class="absolute -top-2 -right-2 bg-purple-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#home" class="nav-link text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="#products" class="nav-link text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Products</a>
                <a href="#about" class="nav-link text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">About</a>
                <a href="#contact" class="nav-link text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Contact</a>
                <div class="pt-4 border-t border-gray-700">
                    <button id="mobile-cart-button" class="flex items-center text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium w-full">
                        <i class="fas fa-shopping-cart mr-2"></i> Cart
                        <span id="mobile-cart-count" class="ml-auto bg-purple-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section id="home" class="relative overflow-hidden py-20 md:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
                <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400 mb-6 fade-in" style="animation-delay: 0.2s;">STEM Express</h1>
                <p class="mt-6 max-w-2xl mx-auto text-xl text-gray-300 fade-in" style="animation-delay: 0.4s;">Pre-order delicious and innovative products created by STEM students of CNHS. From mouth-watering snacks to creative crafts, we've got something for everyone!</p>
                <div class="mt-10 flex justify-center space-x-4 fade-in" style="animation-delay: 0.6s;">
                    <a href="#products" class="nav-link px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 md:py-4 md:text-lg md:px-10 transition-all duration-300 transform hover:scale-105 glow">Browse Products</a>
                    <a href="#about" class="nav-link px-8 py-3 border border-transparent text-base font-medium rounded-md text-purple-200 bg-gray-800 hover:bg-gray-700 md:py-4 md:text-lg md:px-10 transition-all duration-300 transform hover:scale-105">Learn More</a>
                </div>
            </div>
            <div class="absolute -bottom-20 -right-20 w-64 h-64 bg-purple-600 rounded-full filter blur-3xl opacity-20 animate-pulse"></div>
            <div class="absolute -top-20 -left-20 w-64 h-64 bg-emerald-600 rounded-full filter blur-3xl opacity-20 animate-pulse delay-300"></div>
        </section>

        <!-- Featured Products Section -->
        <section id="featured-products" class="py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-4 text-glow">Featured Creations</h2>
                    <p class="text-lg text-gray-400">A taste of our innovative and delicious products.</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="featured-products-grid"></div>
                <div class="text-center mt-12">
                    <a href="#products" id="view-all-products-btn" class="nav-link px-8 py-3 border border-purple-500 text-base font-medium rounded-md text-purple-300 hover:bg-purple-500 hover:text-white md:py-4 md:text-lg md:px-10 transition-all duration-300 transform hover:scale-105">View All Products</a>
                </div>
            </div>
        </section>

        <!-- All Products Section -->
        <section id="products" class="py-20 bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Our Full Menu</h2>
                    <p class="text-lg text-gray-400">Explore the full range of our creative culinary inventions.</p>
                </div>
                <div class="mb-8 flex justify-center">
                    <div class="relative flex-grow max-w-xl">
                        <input type="text" id="product-search" placeholder="Search for products..." class="w-full bg-gray-800 border border-gray-700 rounded-full py-3 px-6 pl-12 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="products-grid"></div>
            </div>
        </section>
        
        <!-- About Section -->
        <section id="about" class="py-20 bg-gradient-to-br from-gray-900 to-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="lg:grid lg:grid-cols-2 lg:gap-16 items-center">
                    <div class="mb-12 lg:mb-0">
                        <div class="relative">
                            <div class="relative rounded-xl overflow-hidden shadow-2xl">
                                <img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80" alt="STEM Students" class="w-full h-auto" onerror="this.onerror=null;this.src='https://placehold.co/600x400/0f172a/f8fafc?text=STEM+Students';">
                                <div class="absolute inset-0 bg-gradient-to-t from-purple-900 to-transparent opacity-70"></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400 sm:text-4xl mb-6">About STEM Express</h2>
                        <p class="text-gray-300 mb-4 text-lg">STEM Express is a student-led initiative by the STEM students of Catanduanes National High School. We combine our knowledge in Science, Technology, Engineering, and Mathematics to create innovative products that solve real-world problems while showcasing our creativity.</p>
                        <div class="mt-8 bg-gray-800 bg-opacity-50 p-6 rounded-lg border-l-4 border-purple-500">
                            <p class="text-gray-300 italic">"Everything you order from STEM Express is made-to-order, so please follow our Facebook page for updates on your order status and delivery information."</p>
                            <div class="mt-4">
                                <a href="https://www.facebook.com/share/16TiJGA4Uy/?mibextid=wwXIfr" target="_blank" class="inline-flex items-center text-purple-400 hover:text-purple-300 font-semibold"><i class="fab fa-facebook mr-2"></i> Follow us on Facebook</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20 bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400 sm:text-4xl">Contact Us</h2>
                    <p class="mt-4 max-w-2xl text-xl text-gray-300 mx-auto">Have questions? Want to know more about our products? Reach out to us!</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="bg-gray-800 bg-opacity-50 p-8 rounded-xl border border-gray-700">
                        <h3 class="text-xl font-bold text-purple-400 mb-6">Get in Touch</h3>
                        <div class="space-y-4">
                            <div class="flex items-start"><div class="flex-shrink-0"><i class="fas fa-map-marker-alt text-purple-500 mt-1"></i></div><div class="ml-3"><p class="text-gray-300">Catanduanes National High School</p><p class="text-gray-400">San Isidro Village, Virac, Catanduanes</p></div></div>
                            <div class="flex items-start"><div class="flex-shrink-0"><i class="fas fa-phone-alt text-purple-500 mt-1"></i></div><div class="ml-3"><p class="text-gray-300">09514342858 (Francis T. Saldua)</p></div></div>
                            <div class="flex items-start"><div class="flex-shrink-0"><i class="fab fa-facebook text-purple-500 mt-1"></i></div><div class="ml-3"><a href="https://www.facebook.com/share/16TiJGA4Uy/?mibextid=wwXIfr" target="_blank" class="text-gray-300 hover:text-purple-400">STEM Express Facebook Page</a></div></div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-gray-800 bg-opacity-50 p-8 rounded-xl border border-gray-700">
                            <h3 class="text-xl font-bold text-purple-400 mb-6">Send Us a Message</h3>
                            <form id="contact-form" class="space-y-4">
                                <div><label for="name" class="block text-sm font-medium text-gray-300">Name</label><input type="text" id="name" name="name" required class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 text-white"></div>
                                <div><label for="email" class="block text-sm font-medium text-gray-300">Email</label><input type="email" id="email" name="email" required class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 text-white"></div>
                                <div><label for="message" class="block text-sm font-medium text-gray-300">Message</label><textarea id="message" name="message" rows="4" required class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 text-white"></textarea></div>
                                <div><button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all duration-300 transform hover:scale-105">Send Message</button></div>
                            </form>
                            <div id="contact-form-feedback" class="text-center mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center"><i class="fas fa-atom text-purple-500 text-2xl mr-2"></i><span class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-emerald-400">STEM EXPRESS</span></div>
                    <p class="mt-4 text-gray-400">Innovative products by STEM students of CNHS. Quality and creativity in every item.</p>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-300 tracking-wider uppercase">Quick Links</h3>
                    <div class="mt-4 space-y-2">
                        <a href="#home" class="nav-link block text-gray-400 hover:text-white transition-colors duration-300">Home</a>
                        <a href="#products" class="nav-link block text-gray-400 hover:text-white transition-colors duration-300">Products</a>
                        <a href="#about" class="nav-link block text-gray-400 hover:text-white transition-colors duration-300">About</a>
                        <a href="#contact" class="nav-link block text-gray-400 hover:text-white transition-colors duration-300">Contact</a>
                    </div>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-300 tracking-wider uppercase">Connect With Us</h3>
                    <div class="mt-4 flex space-x-6">
                        <a href="https://www.facebook.com/share/16TiJGA4Uy/?mibextid=wwXIfr" target="_blank" class="text-gray-400 hover:text-purple-400 transition-colors duration-300"><i class="fab fa-facebook-f text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-purple-400 transition-colors duration-300"><i class="fab fa-instagram text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-purple-400 transition-colors duration-300"><i class="fab fa-twitter text-xl"></i></a>
                    </div>
                    <div class="mt-6"><p class="text-gray-400 text-sm">Developer: Francis T. Saldua</p></div>
                </div>
            </div>
            <div class="mt-12 pt-8 border-t border-gray-800"><p class="text-gray-400 text-sm text-center">&copy; 2024 STEM Express. All rights reserved.</p></div>
        </div>
    </footer>

    <!-- All Modals and Cart Sidebar -->
    <div id="modals-container"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDgKCFUvQ___3HXsT9xLA3ZIbchywwpY6M", // IMPORTANT: Replace with your actual Firebase config
            authDomain: "stem-express-9512e.firebaseapp.com",
            projectId: "stem-express-9512e",
            storageBucket: "stem-express-9512e.appspot.com",
            messagingSenderId: "577722816518",
            appId: "1:577722816518:web:e6c626c820d4d54a794b87"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const products = [
            { id: 1, name: "Timmy Cookies", price: 1, image: "https://i.imgur.com/LErvFbm.jpeg", description: "Taong nag mahal ng wagas, at dahil duon naubusan siya ng pampagas", ingredients: "Cute, Cutipie, Cute parin inulit ko lang, Pogi, Cute naman ulit", tagline: "Balik ka na pls", nutrition: "Calories: Imissyou" },
            { id: 2, name: "Math Muffins", price: 40, image: "https://images.unsplash.com/photo-1550583724-b2692b85b150?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Moist and fluffy muffins with a mathematical precision in every bite.", ingredients: "Flour, sugar, eggs, milk, butter, baking powder, vanilla extract", tagline: "Calculated for deliciousness.", nutrition: "Calories: 220" },
            { id: 3, name: "Science Cookies", price: 35, image: "https://images.unsplash.com/photo-1558961363-fa8fdf82db35?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Crispy on the outside, chewy on the inside - a perfect chemical reaction!", ingredients: "Flour, sugar, butter, eggs, vanilla, baking soda, chocolate chips", tagline: "The perfect experiment.", nutrition: "Calories: 180" },
            { id: 4, name: "Engineering Energy Bars", price: 60, image: "https://images.unsplash.com/photo-1549918864-48ac978761a4?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Engineered to give you sustained energy throughout the day.", ingredients: "Oats, honey, peanut butter, almonds, dried cranberries, chia seeds", tagline: "Built to last.", nutrition: "Calories: 350" },
            { id: 5, name: "Tech Tacos", price: 70, image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Innovative taco combinations that will reboot your taste buds.", ingredients: "Tortillas, chicken/beef/beans, lettuce, tomatoes, cheese, salsa", tagline: "A byte of flavor.", nutrition: "Calories: 450" },
            { id: 6, name: "Biology Bread", price: 80, image: "https://images.unsplash.com/photo-1509440159596-0249088772ff?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Artisanal sourdough bread made with natural yeast cultures.", ingredients: "Flour, water, salt, sourdough starter", tagline: "A living delight.", nutrition: "Calories: 150 per slice" },
            { id: 7, name: "Chemistry Cupcakes", price: 45, image: "https://images.unsplash.com/photo-1486427944299-d1955d23e34d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Fluffy cupcakes with colorful frosting that demonstrate chemical reactions.", ingredients: "Flour, sugar, eggs, butter, milk, baking powder, vanilla", tagline: "A sweet reaction.", nutrition: "Calories: 300" },
            { id: 8, name: "Physics Pizza", price: 120, image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Perfectly balanced pizza that demonstrates principles of physics.", ingredients: "Pizza dough, tomato sauce, mozzarella cheese, toppings", tagline: "The universal law of deliciousness.", nutrition: "Calories: 350 per slice" },
            { id: 9, name: "Algebra Apple Pie", price: 90, image: "https://images.unsplash.com/photo-1562007908-859b4ba9a1a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "A perfectly proportioned pie that solves for x, where x = delicious.", ingredients: "Apples, sugar, cinnamon, flour, butter, lemon juice", tagline: "Solve for delicious.", nutrition: "Calories: 400 per slice" },
            { id: 10, name: "Geometry Granola", price: 55, image: "https://images.unsplash.com/photo-1609951651556-5334e2706168?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Crunchy granola with geometric clusters of oats, nuts, and honey.", ingredients: "Oats, honey, almonds, coconut flakes, sunflower seeds", tagline: "The perfect shape for a snack.", nutrition: "Calories: 250 per serving" },
            { id: 11, name: "Robotics Rice Balls", price: 65, image: "https://images.unsplash.com/photo-1516594798947-e83ab3fe1baf?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Precision-crafted rice balls with various fillings.", ingredients: "Rice, nori, tuna mayo, salmon, teriyaki chicken", tagline: "Automated for flavor.", nutrition: "Calories: 200 per ball" },
            { id: 12, name: "Programming Pancakes", price: 60, image: "https://images.unsplash.com/photo-1562376552-8d96985ca8e1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Stackable pancakes that follow the DRY principle (Delicious Repeated Yumminess).", ingredients: "Flour, eggs, milk, butter, baking powder, sugar, salt", tagline: "A stack of perfection.", nutrition: "Calories: 500 per stack" },
            { id: 13, name: "Astronomy Avocado Toast", price: 75, image: "https://images.unsplash.com/photo-1584308666744-8480404b63ae?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "A cosmic combination of creamy avocado on artisanal bread.", ingredients: "Sourdough bread, avocado, cherry tomatoes, feta cheese, olive oil", tagline: "Out of this world.", nutrition: "Calories: 350" },
            { id: 14, name: "Environmental Empanadas", price: 50, image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Sustainable and eco-friendly empanadas with locally sourced fillings.", ingredients: "Flour, butter, salt, water, beef, chicken, cheese, vegetables", tagline: "A taste of sustainability.", nutrition: "Calories: 300" },
            { id: 15, name: "Biotech Burgers", price: 95, image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Juicy burgers that demonstrate food science at its finest.", ingredients: "Beef patty, brioche bun, lettuce, tomato, onion, pickles, cheese", tagline: "The future of flavor.", nutrition: "Calories: 600" },
            { id: 16, name: "Nanotech Nachos", price: 85, image: "https://images.unsplash.com/photo-1571407970349-bc81e7e96d47?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Perfectly layered nachos with precision-placed toppings.", ingredients: "Tortilla chips, cheese, jalapeños, black beans, salsa, sour cream", tagline: "Small details, big taste.", nutrition: "Calories: 700" },
            { id: 17, name: "Quantum Quiche", price: 80, image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "A quiche that exists in multiple delicious states until observed.", ingredients: "Pie crust, eggs, cream, cheese, bacon, spinach, onions", tagline: "A superposition of flavor.", nutrition: "Calories: 450 per slice" },
            { id: 18, name: "Genetics Gelato", price: 65, image: "https://images.unsplash.com/photo-1560008581-09826d1de69e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Creamy Italian gelato with flavors that combine in unexpected ways.", ingredients: "Milk, cream, sugar, chocolate, vanilla, strawberry, pistachio", tagline: "A delicious combination.", nutrition: "Calories: 250 per scoop" },
            { id: 19, name: "Dynamics Donuts", price: 45, image: "https://images.unsplash.com/photo-1551024601-bec78aea704b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Donuts that demonstrate principles of motion with their perfect shape.", ingredients: "Flour, sugar, eggs, milk, butter, yeast, glaze", tagline: "The motion of deliciousness.", nutrition: "Calories: 300" },
            { id: 20, name: "Thermodynamics Tea", price: 40, image: "https://images.unsplash.com/photo-1568649929103-28ffbefaca1e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Special tea blends that maintain perfect temperature longer.", ingredients: "Tea leaves, herbs, spices", tagline: "The perfect temperature.", nutrition: "Calories: 5" },
            { id: 21, name: "Optics Oatmeal", price: 50, image: "https://images.unsplash.com/photo-1546069901-d5bfd2cbfb1f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "A breakfast that reflects the importance of a good start to your day.", ingredients: "Oats, milk/water, honey, cinnamon, banana, nuts, seeds", tagline: "A reflection of a good morning.", nutrition: "Calories: 400" },
            { id: 22, name: "Kinetics Kebabs", price: 90, image: "https://images.unsplash.com/photo-1601050691147-9e220f1a0d9c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Skewered meats and vegetables that demonstrate motion and energy transfer.", ingredients: "Chicken/beef, bell peppers, onions, mushrooms, marinade", tagline: "The energy of flavor.", nutrition: "Calories: 500" },
            { id: 23, name: "Fluid Mechanics Smoothies", price: 55, image: "https://images.unsplash.com/photo-1505576399279-565b52d4ac71?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Perfectly blended smoothies that demonstrate viscosity and flow.", ingredients: "Banana, berries, mango, yogurt, milk/juice, honey, ice", tagline: "The flow of deliciousness.", nutrition: "Calories: 300" },
            { id: 24, name: "Statistics Salad", price: 70, image: "https://images.unsplash.com/photo-1546793665-c74683f339c1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "A balanced mix of greens and toppings that represent data distribution.", ingredients: "Mixed greens, cherry tomatoes, cucumber, carrots, croutons", tagline: "A significant amount of flavor.", nutrition: "Calories: 350" },
            { id: 25, name: "Calculus Croissants", price: 60, image: "https://images.unsplash.com/photo-1587814213271-7a6625b76c33?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Flaky, buttery croissants with layers that approach infinity.", ingredients: "Flour, butter, yeast, milk, sugar, salt, chocolate", tagline: "The limit of deliciousness.", nutrition: "Calories: 400" },
            { id: 26, name: "Trigonometry Tiramisu", price: 85, image: "https://images.unsplash.com/photo-1563805042-7684c019e1cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Layered dessert that demonstrates perfect angles and ratios.", ingredients: "Ladyfingers, coffee, mascarpone cheese, eggs, sugar, cocoa", tagline: "The perfect angle.", nutrition: "Calories: 500" },
            { id: 27, name: "Biochemistry Bagels", price: 50, image: "https://images.unsplash.com/photo-1588466585717-80466393919e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "New York-style bagels that demonstrate the Maillard reaction at work.", ingredients: "Flour, water, yeast, malt syrup, salt, sesame, poppy seeds", tagline: "A reaction of flavor.", nutrition: "Calories: 300" },
            { id: 28, name: "Meteorology Macarons", price: 65, image: "https://images.unsplash.com/photo-1558326567-98ae2405596b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Delicate French macarons that are as unpredictable as the weather.", ingredients: "Almond flour, powdered sugar, egg whites, granulated sugar", tagline: "A forecast of deliciousness.", nutrition: "Calories: 100 per macaron" },
            { id: 29, name: "Zoology Zucchini Bread", price: 75, image: "https://images.unsplash.com/photo-1608500218951-6d0f7a1b0b3a?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Moist and flavorful bread that demonstrates how plants can be just as interesting as animals.", ingredients: "Zucchini, flour, sugar, eggs, oil, cinnamon, baking soda", tagline: "A wild taste.", nutrition: "Calories: 250 per slice" },
            { id: 30, name: "Botany Bubble Tea", price: 60, image: "https://images.unsplash.com/photo-1591871937573-74dbba515c4c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80", description: "Refreshing tea with tapioca pearls that represent plant cells.", ingredients: "Tea, milk, tapioca pearls, sugar, flavor syrups", tagline: "A taste of nature.", nutrition: "Calories: 300" }
        ];

        let cart = [];
        const DELIVERY_FEE = 30;

        // --- CORE APP LOGIC ---
        
        // App initialization
        document.addEventListener('DOMContentLoaded', () => {
            renderAllModals();
            setupEventListeners();
            renderProducts(products.slice(0, 4), document.getElementById('featured-products-grid'));
            renderProducts(products, document.getElementById('products-grid'));
            updateCart();
        });

        function renderProducts(productsToRender, container) {
            if (!container) return;
            container.innerHTML = productsToRender.map(createProductCardHTML).join('');
            const cards = container.querySelectorAll('.card-enter');
            cards.forEach((card, index) => {
                setTimeout(() => card.classList.add('card-enter-active'), index * 100);
            });
        }

        function createProductCardHTML(product) {
            return `
                <div class="product-card bg-gray-800 rounded-lg overflow-hidden shadow-md flex flex-col card-enter" data-id="${product.id}">
                    <div class="relative overflow-hidden h-56">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110" onerror="this.onerror=null;this.src='https://placehold.co/500x500/0f172a/f8fafc?text=${product.name.replace(/\s/g, '+')}';">
                        <div class="absolute top-2 right-2 bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg">₱${product.price.toFixed(2)}</div>
                    </div>
                    <div class="p-4 flex-grow flex flex-col">
                        <h3 class="text-lg font-bold text-white mb-2 truncate">${product.name}</h3>
                        <p class="text-gray-400 text-sm mb-4 line-clamp-2 flex-grow">${product.description}</p>
                        <div class="mt-auto flex items-center justify-between">
                            <button class="view-product text-purple-400 hover:text-purple-300 text-sm font-medium flex items-center" data-id="${product.id}"><i class="fas fa-eye mr-1"></i> View Details</button>
                            <button class="add-to-cart bg-purple-600 hover:bg-purple-700 text-white py-1 px-3 rounded-full text-sm transition-colors duration-300 flex items-center" data-id="${product.id}"><i class="fas fa-cart-plus mr-1"></i> Add</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // --- CART LOGIC ---
        function addToCart(productId, quantity = 1) {
            const product = products.find(p => p.id == productId);
            if (!product) return;
            const existingItem = cart.find(item => item.id == productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({ ...product, quantity });
            }
            updateCart();
            showAddToCartAnimation();
        }

        function updateCartItemQuantity(productId, quantity) {
            const item = cart.find(item => item.id == productId);
            if (item) {
                item.quantity = Math.max(1, quantity); // Ensure quantity is at least 1
                updateCart();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id != productId);
            updateCart();
        }

        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartSummary = document.getElementById('cart-summary');
            const emptyCartMessage = document.getElementById('empty-cart-message');

            // Safety check to prevent errors if elements are not found
            if (!cartItemsContainer || !cartSummary || !emptyCartMessage) {
                console.error("Cart UI elements not found. Cannot update cart view.");
                return;
            }
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '';
                emptyCartMessage.classList.remove('hidden');
                cartSummary.classList.add('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                cartSummary.classList.remove('hidden');
                cartItemsContainer.innerHTML = cart.map(item => `
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 flex items-start">
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/64x64/0f172a/f8fafc?text=Img';">
                        <div class="ml-4 flex-grow">
                            <h4 class="text-sm font-medium text-white">${item.name}</h4>
                            <p class="text-purple-400 text-sm font-bold">₱${item.price.toFixed(2)}</p>
                            <div class="mt-2 flex items-center">
                                <button class="cart-quantity-btn decrease-quantity bg-gray-700 hover:bg-gray-600 text-white w-6 h-6 rounded flex items-center justify-center" data-id="${item.id}"><i class="fas fa-minus text-xs"></i></button>
                                <input type="number" min="1" value="${item.quantity}" class="quantity-input mx-2 w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm" data-id="${item.id}">
                                <button class="cart-quantity-btn increase-quantity bg-gray-700 hover:bg-gray-600 text-white w-6 h-6 rounded flex items-center justify-center" data-id="${item.id}"><i class="fas fa-plus text-xs"></i></button>
                            </div>
                        </div>
                        <button class="remove-item text-gray-400 hover:text-white ml-2" data-id="${item.id}"><i class="fas fa-times"></i></button>
                    </div>
                `).join('');
            }
            updateCartTotals();
        }

        function updateCartTotals(deliveryFeeAmount = 0) {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = subtotal + deliveryFeeAmount;
            
            document.querySelectorAll('#cart-subtotal, #checkout-subtotal').forEach(el => el.textContent = `₱${subtotal.toFixed(2)}`);
            document.querySelectorAll('#delivery-fee, #checkout-delivery').forEach(el => el.textContent = `₱${deliveryFeeAmount.toFixed(2)}`);
            document.querySelectorAll('#cart-total, #checkout-total').forEach(el => el.textContent = `₱${total.toFixed(2)}`);
            
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
            document.getElementById('mobile-cart-count').textContent = count;
        }
        
        // --- MODAL LOGIC ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('overflow-hidden');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                const anyModalOpen = document.querySelector('.fixed.inset-0.z-50.flex');
                if (!anyModalOpen) {
                    document.body.classList.remove('overflow-hidden');
                }
            }
        }
        
        function viewProduct(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) return;

            document.getElementById('modal-product-name').textContent = product.name;
            document.getElementById('modal-product-image').src = product.image;
            document.getElementById('modal-product-price').textContent = `₱${product.price.toFixed(2)}`;
            document.getElementById('modal-product-description').textContent = product.description;
            document.getElementById('modal-product-ingredients').textContent = product.ingredients;
            document.getElementById('modal-product-tagline').textContent = product.tagline;
            document.getElementById('modal-product-nutrition').textContent = product.nutrition;
            document.getElementById('add-to-cart-modal').dataset.id = product.id;
            document.getElementById('product-quantity').textContent = 1;
            
            openModal('product-modal');
        }

        function openCheckout() {
            if (cart.length === 0) {
                // A simple alert is fine for now, but a styled modal would be better.
                const notification = document.createElement('div');
                notification.className = 'fixed top-5 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg animate-pulse';
                notification.textContent = 'Your cart is empty!';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
                return;
            }
            document.getElementById('checkout-items').innerHTML = cart.map(item => `
                <div class="flex justify-between text-sm">
                    <span class="text-gray-300">${item.name} x${item.quantity}</span>
                    <span class="text-gray-300">₱${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            updateCheckoutDeliveryFee();
            openModal('checkout-modal');
        }
        
        // --- EVENT HANDLING ---
        function setupEventListeners() {
            document.addEventListener('click', e => {
                // Product Card buttons
                if (e.target.closest('.add-to-cart')) {
                    const button = e.target.closest('.add-to-cart');
                    addToCart(button.dataset.id);
                    button.innerHTML = '<i class="fas fa-check mr-1"></i> Added';
                    button.classList.replace('bg-purple-600', 'bg-emerald-600');
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-cart-plus mr-1"></i> Add';
                        button.classList.replace('bg-emerald-600', 'bg-purple-600');
                    }, 2000);
                }
                if (e.target.closest('.view-product')) viewProduct(e.target.closest('.view-product').dataset.id);

                // Cart Sidebar
                if (e.target.closest('#cart-button') || e.target.closest('#mobile-cart-button')) openModal('cart-sidebar');
                if (e.target.closest('#close-cart') || e.target.id === 'close-cart-overlay') closeModal('cart-sidebar');
                if (e.target.closest('.remove-item')) removeFromCart(e.target.closest('.remove-item').dataset.id);
                if (e.target.closest('.increase-quantity')) {
                    const item = cart.find(i => i.id == e.target.closest('.increase-quantity').dataset.id);
                    if(item) updateCartItemQuantity(item.id, item.quantity + 1);
                }
                if (e.target.closest('.decrease-quantity')) {
                    const item = cart.find(i => i.id == e.target.closest('.decrease-quantity').dataset.id);
                    if(item) updateCartItemQuantity(item.id, item.quantity - 1);
                }

                // Product Modal
                if (e.target.closest('#close-modal')) closeModal('product-modal');
                if (e.target.closest('#increase-quantity')) {
                    let qtyEl = document.getElementById('product-quantity');
                    qtyEl.textContent = parseInt(qtyEl.textContent) + 1;
                }
                if (e.target.closest('#decrease-quantity')) {
                    let qtyEl = document.getElementById('product-quantity');
                    qtyEl.textContent = Math.max(1, parseInt(qtyEl.textContent) - 1);
                }
                if (e.target.id === 'add-to-cart-modal') {
                    const quantity = parseInt(document.getElementById('product-quantity').textContent);
                    addToCart(e.target.dataset.id, quantity);
                    closeModal('product-modal');
                }

                // Checkout
                if (e.target.id === 'checkout-button') openCheckout();
                if (e.target.id === 'close-checkout-modal') closeModal('checkout-modal');
                if (e.target.id === 'place-order') handlePlaceOrder();
                if (e.target.closest('#close-confirmation')) closeModal('confirmation-modal');

                // Nav links
                if (e.target.closest('.nav-link')) {
                    e.preventDefault();
                    const targetId = e.target.closest('.nav-link').getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                    if (window.innerWidth < 768) { // Close mobile menu on click
                        document.getElementById('mobile-menu').classList.add('hidden');
                    }
                }
                
                // Mobile Menu
                if (e.target.closest('#mobile-menu-button')) {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                }
            });
            
            // Input event listeners
            document.getElementById('product-search').addEventListener('input', e => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = products.filter(p => p.name.toLowerCase().includes(searchTerm) || p.description.toLowerCase().includes(searchTerm));
                renderProducts(filtered, document.getElementById('products-grid'));
            });

            document.addEventListener('change', e => {
                if(e.target.classList.contains('quantity-input')) {
                    updateCartItemQuantity(e.target.dataset.id, parseInt(e.target.value));
                }
                if(e.target.name === 'isStudent' || e.target.name === 'student-delivery' || e.target.name === 'non-student-delivery') {
                    updateCheckoutFormVisibility();
                    updateCheckoutDeliveryFee();
                }
            });

            document.getElementById('contact-form').addEventListener('submit', handleContactSubmit);
        }
        
        // --- CHECKOUT & FIREBASE LOGIC ---
        function updateCheckoutFormVisibility() {
            const isStudent = document.querySelector('input[name="isStudent"]:checked').value === 'yes';
            document.getElementById('student-form').style.display = isStudent ? 'block' : 'none';
            document.getElementById('non-student-form').style.display = isStudent ? 'none' : 'block';
            
            if (isStudent) {
                const isSchoolDelivery = document.querySelector('input[name="student-delivery"]:checked').value === 'school';
                document.getElementById('student-delivery-address-container').style.display = isSchoolDelivery ? 'none' : 'block';
            }
        }

        function updateCheckoutDeliveryFee() {
            const isStudent = document.querySelector('input[name="isStudent"]:checked').value === 'yes';
            let fee = 0;
            if (isStudent) {
                const deliveryType = document.querySelector('input[name="student-delivery"]:checked').value;
                if (deliveryType === 'other') fee = DELIVERY_FEE;
            } else {
                const deliveryType = document.querySelector('input[name="non-student-delivery"]:checked').value;
                if (deliveryType === 'delivery') fee = DELIVERY_FEE;
            }
            updateCartTotals(fee);
        }

        async function handlePlaceOrder() {
            const orderButton = document.getElementById('place-order');
            orderButton.disabled = true;
            orderButton.textContent = 'Placing Order...';
            
            const isStudent = document.querySelector('input[name="isStudent"]:checked').value === 'yes';
            let customerInfo = {};
            let validationError = false;

            if (isStudent) {
                customerInfo = {
                    type: 'Student',
                    name: document.getElementById('student-name').value,
                    gradeSection: document.getElementById('grade-section').value,
                    fbUrl: document.getElementById('student-fb').value,
                    phone: document.getElementById('student-phone').value,
                    deliveryOption: document.querySelector('input[name="student-delivery"]:checked').value,
                    deliveryAddress: document.getElementById('student-delivery-address').value,
                    notes: document.getElementById('notes').value,
                };
                if (!customerInfo.name || !customerInfo.gradeSection) validationError = true;
            } else {
                customerInfo = {
                    type: 'Non-Student',
                    name: document.getElementById('non-student-name').value,
                    fbUrl: document.getElementById('non-student-fb').value,
                    address: document.getElementById('non-student-address').value,
                    phone: document.getElementById('non-student-phone').value,
                    deliveryOption: document.querySelector('input[name="non-student-delivery"]:checked').value,
                    notes: document.getElementById('notes').value,
                };
                if (!customerInfo.name || !customerInfo.address || !customerInfo.phone) validationError = true;
            }

            if (validationError) {
                alert('Please fill in all required fields.');
                orderButton.disabled = false;
                orderButton.textContent = 'Place Order';
                return;
            }

            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = parseFloat(document.getElementById('checkout-delivery').textContent.replace('₱', ''));
            
            const orderData = {
                customerInfo,
                items: cart.map(item => ({ id: item.id, name: item.name, quantity: item.quantity, price: item.price })),
                subtotal,
                deliveryFee,
                total: subtotal + deliveryFee,
                status: 'Pending',
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, "orders"), orderData);
                closeModal('checkout-modal');
                openModal('confirmation-modal');
                createConfetti();
                cart = [];
                updateCart();
            } catch (error) {
                console.error("Error placing order: ", error);
                alert("There was an error placing your order. Please try again.");
            } finally {
                orderButton.disabled = false;
                orderButton.textContent = 'Place Order';
            }
        }

        async function handleContactSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const feedbackEl = document.getElementById('contact-form-feedback');
            const button = form.querySelector('button[type="submit"]');
            button.disabled = true;
            button.textContent = 'Sending...';

            try {
                const messageData = {
                    name: form.name.value,
                    email: form.email.value,
                    message: form.message.value,
                    submittedAt: new Date()
                };
                await addDoc(collection(db, "messages"), messageData);
                
                feedbackEl.textContent = "Thank you! Your message has been sent.";
                feedbackEl.className = "text-emerald-400";
                form.reset();
            } catch (error) {
                console.error("Error sending message: ", error);
                feedbackEl.textContent = "Sorry, there was an error. Please try again.";
                feedbackEl.className = "text-red-400";
            } finally {
                button.disabled = false;
                button.textContent = 'Send Message';
            }
        }
        
        // --- UTILITY FUNCTIONS ---
        function showAddToCartAnimation() {
            const cartIcon = document.getElementById('cart-button').querySelector('i');
            cartIcon.classList.add('cart-bounce');
            setTimeout(() => cartIcon.classList.remove('cart-bounce'), 600);
        }

        function createConfetti() {
            const confettiContainer = document.body;
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.backgroundColor = ['#6d28d9', '#10b981', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 4)];
                confettiContainer.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5000);
            }
        }
        
        // --- RENDER ALL MODALS (to keep main HTML clean) ---
        function renderAllModals() {
            document.getElementById('modals-container').innerHTML = `
                <!-- Cart Sidebar -->
                <div id="cart-sidebar" class="fixed inset-0 z-50 hidden">
                    <div class="absolute inset-0 bg-gray-900 bg-opacity-75" id="close-cart-overlay"></div>
                    <div class="relative flex flex-col w-full max-w-md ml-auto h-full bg-gray-900 shadow-xl border-l border-purple-900">
                        <div class="p-6 flex justify-between items-center border-b border-gray-800">
                            <h2 class="text-2xl font-bold text-purple-400">Your Cart</h2>
                            <button id="close-cart" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
                        </div>
                        <div class="p-6 overflow-y-auto flex-grow">
                            <div id="cart-items" class="space-y-4"></div>
                            <div id="empty-cart-message" class="text-center py-10 hidden"><i class="fas fa-shopping-cart text-4xl text-gray-600 mb-4"></i><p class="text-gray-400">Your cart is empty</p></div>
                        </div>
                        <div id="cart-summary" class="p-6 border-t border-gray-800 hidden">
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between"><span class="text-gray-400">Subtotal</span><span id="cart-subtotal" class="text-gray-300"></span></div>
                                <div class="flex justify-between"><span class="text-gray-400">Delivery Fee</span><span id="delivery-fee" class="text-gray-300"></span></div>
                                <div class="flex justify-between text-lg font-bold"><span class="text-gray-300">Total</span><span id="cart-total" class="text-purple-400"></span></div>
                            </div>
                            <button id="checkout-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-md font-medium transition-all duration-300 transform hover:scale-105">Proceed to Checkout</button>
                        </div>
                    </div>
                </div>

                <!-- Product Modal -->
                <div id="product-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
                    <div class="absolute inset-0 bg-gray-900 opacity-75" onclick="closeModal('product-modal')"></div>
                    <div class="relative bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:max-w-4xl w-full max-h-[90vh] flex flex-col">
                         <div class="p-4 sm:p-6 flex-grow overflow-y-auto">
                            <div class="flex justify-between items-start mb-4">
                                <h3 id="modal-product-name" class="text-2xl leading-6 font-bold text-purple-400"></h3>
                                <button id="close-modal" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <img id="modal-product-image" src="" alt="" class="w-full h-64 object-cover rounded-lg">
                                    <div class="mt-4 flex items-center justify-between">
                                        <span id="modal-product-price" class="text-2xl font-bold text-white"></span>
                                        <div class="flex items-center space-x-2">
                                            <button id="decrease-quantity" class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-minus"></i></button>
                                            <span id="product-quantity" class="text-white w-8 text-center font-bold text-lg">1</span>
                                            <button id="increase-quantity" class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-plus"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div><h4 class="text-lg font-semibold text-white">Description</h4><p id="modal-product-description" class="text-gray-300"></p></div>
                                    <div><h4 class="text-lg font-semibold text-white">Ingredients</h4><p id="modal-product-ingredients" class="text-gray-300 text-sm"></p></div>
                                    <div><h4 class="text-lg font-semibold text-white">Tagline</h4><p id="modal-product-tagline" class="text-gray-300 italic"></p></div>
                                    <div><h4 class="text-lg font-semibold text-white">Nutrition Info</h4><p id="modal-product-nutrition" class="text-gray-300"></p></div>
                                </div>
                            </div>
                         </div>
                         <div class="bg-gray-800 px-4 py-3 sm:px-6 border-t border-gray-700">
                            <button id="add-to-cart-modal" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-md font-medium transition-all duration-300 transform hover:scale-105">Add to Cart</button>
                         </div>
                    </div>
                </div>

                <!-- Checkout Modal -->
                <div id="checkout-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
                     <div class="absolute inset-0 bg-gray-900 opacity-75" onclick="closeModal('checkout-modal')"></div>
                     <div class="relative bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:max-w-2xl w-full max-h-[90vh] flex flex-col">
                        <div class="p-4 sm:p-6 flex-grow overflow-y-auto">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl leading-6 font-bold text-purple-400">Checkout</h3>
                                <button id="close-checkout-modal" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="space-y-6">
                                <!-- Form content here -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Are you a CNHS student?</label>
                                    <div class="flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="isStudent" value="yes" class="form-radio text-purple-600" checked><span class="ml-2 text-gray-300">Yes</span></label><label class="inline-flex items-center"><input type="radio" name="isStudent" value="no" class="form-radio text-purple-600"><span class="ml-2 text-gray-300">No</span></label></div>
                                </div>
                                <div id="student-form">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label for="student-name" class="block text-sm font-medium text-gray-300 mb-1">Full Name *</label><input type="text" id="student-name" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                        <div><label for="grade-section" class="block text-sm font-medium text-gray-300 mb-1">Grade & Section *</label><input type="text" id="grade-section" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    </div>
                                    <div class="mt-4"><label for="student-fb" class="block text-sm font-medium text-gray-300 mb-1">Facebook Profile URL</label><input type="url" id="student-fb" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    <div class="mt-4"><label for="student-phone" class="block text-sm font-medium text-gray-300 mb-1">Phone Number</label><input type="tel" id="student-phone" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    <div class="mt-4"><label class="block text-sm font-medium text-gray-300 mb-1">Delivery Option</label><div class="flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="student-delivery" value="school" class="form-radio text-purple-600" checked><span class="ml-2 text-gray-300">School Delivery (Free)</span></label><label class="inline-flex items-center"><input type="radio" name="student-delivery" value="other" class="form-radio text-purple-600"><span class="ml-2 text-gray-300">Other Location (Fee applies)</span></label></div></div>
                                    <div id="student-delivery-address-container" class="mt-4 hidden"><label for="student-delivery-address" class="block text-sm font-medium text-gray-300 mb-1">Delivery Address</label><input type="text" id="student-delivery-address" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                </div>
                                <div id="non-student-form" class="hidden">
                                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label for="non-student-name" class="block text-sm font-medium text-gray-300 mb-1">Full Name *</label><input type="text" id="non-student-name" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                        <div><label for="non-student-phone" class="block text-sm font-medium text-gray-300 mb-1">Phone Number *</label><input type="tel" id="non-student-phone" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    </div>
                                    <div class="mt-4"><label for="non-student-fb" class="block text-sm font-medium text-gray-300 mb-1">Facebook Profile URL</label><input type="url" id="non-student-fb" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    <div class="mt-4"><label for="non-student-address" class="block text-sm font-medium text-gray-300 mb-1">Address *</label><input type="text" id="non-student-address" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></div>
                                    <div class="mt-4"><label class="block text-sm font-medium text-gray-300 mb-1">Delivery Option</label><div class="flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="non-student-delivery" value="pickup" class="form-radio text-purple-600"><span class="ml-2 text-gray-300">Self Pickup (Free)</span></label><label class="inline-flex items-center"><input type="radio" name="non-student-delivery" value="delivery" class="form-radio text-purple-600" checked><span class="ml-2 text-gray-300">Delivery (Fee applies)</span></label></div></div>
                                </div>
                                <div class="mt-4"><label for="notes" class="block text-sm font-medium text-gray-300 mb-1">Special Requests/Notes</label><textarea id="notes" rows="2" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white"></textarea></div>
                                <div class="mt-6 bg-gray-700 p-4 rounded-lg">
                                    <h4 class="text-lg font-semibold text-white mb-2">Order Summary</h4>
                                    <div id="checkout-items" class="space-y-2 mb-4"></div>
                                    <div class="border-t border-gray-600 pt-2 space-y-1">
                                        <div class="flex justify-between"><span class="text-gray-300">Subtotal:</span><span id="checkout-subtotal" class="text-gray-300"></span></div>
                                        <div class="flex justify-between"><span class="text-gray-300">Delivery Fee:</span><span id="checkout-delivery" class="text-gray-300"></span></div>
                                        <div class="flex justify-between font-bold mt-2"><span class="text-white">Total:</span><span id="checkout-total" class="text-purple-400"></span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 px-4 py-3 sm:px-6 border-t border-gray-700">
                             <button id="place-order" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-md font-medium transition-all duration-300 transform hover:scale-105">Place Order</button>
                        </div>
                     </div>
                </div>

                <!-- Confirmation Modal -->
                <div id="confirmation-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
                    <div class="absolute inset-0 bg-gray-900 opacity-90" onclick="closeModal('confirmation-modal')"></div>
                    <div class="relative bg-gray-800 rounded-lg text-center overflow-hidden shadow-xl transform transition-all sm:max-w-lg w-full p-6">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-purple-100"><i class="fas fa-check text-purple-600 text-xl"></i></div>
                        <div class="mt-3">
                            <h3 class="text-3xl leading-6 font-bold text-purple-400 mb-4 text-glow">DIOS MABALOS!</h3>
                            <p class="text-gray-300 mb-4">Your order has been placed successfully! We'll contact you soon with more details.</p>
                            <p class="text-gray-400 text-sm">Don't forget to follow our Facebook page for updates.</p>
                            <div class="mt-6">
                                <button id="close-confirmation" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md font-medium">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

    </script>
</body>
</html>
